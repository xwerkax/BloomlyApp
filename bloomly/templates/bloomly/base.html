{% load static %}
{% load avatar_tags %}

<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Bloomly - Aplikacja do pielęgnacji roślin{% endblock %}</title>

<!-- W base.html -->
<!-- NAJPIERW Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">


  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

  <!-- DODAJ TO TUTAJ - inline CSS -->
  <style>
    /* Badge'e dla czynności pielęgnacyjnych */
    .badge-custom {
      display: inline-block;
      padding: 0.35rem 0.6rem;
      font-size: 0.75rem;
      font-weight: 600;
      line-height: 1;
      border-radius: 0.375rem;
      vertical-align: middle;
      text-align: center;
    }

    .badge-nawozenie {
      background-color: #f48fb1 !important; /* Różowy */
      color: #ffffff !important;
    }

    .badge-przycinanie {
      background-color: #ff8a65 !important; /* Pomarańczowy */
      color: #ffffff !important;
    }

    .badge-przesadzanie {
      background-color: #a1887f !important; /* Brązowy */
      color: #ffffff !important;
    }

    .badge-podlewanie {
      background-color: #4fc3f7 !important; /* Niebieski */
      color: #ffffff !important;
    }

    .badge-default {
      background-color: #4fc3f7 !important; /* Szary */
      color: #ffffff !important;
    }
  </style>
</head>

  {% block extra_css %}{% endblock %}

  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
    .navbar { box-shadow: 0 2px 4px rgba(0,0,0,.1); }
    .main-content { flex: 1; padding-top: 20px; padding-bottom: 40px; }
    .dropdown-menu { border: none; box-shadow: 0 4px 6px rgba(0,0,0,.1); }
  </style>

  <!-- Inicjalizacja motywu przed renderem -->
  <script>
    (function () {
      try {
        var saved = localStorage.getItem('bloomly-theme');
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-bs-theme', theme);
      } catch (e) {}
    })();
  </script>
</head>
<body>
  <!-- Navbar (sam dopasowuje się do motywu) -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom">
    <div class="container-fluid">
      <!-- Logo -->
      <a class="navbar-brand" href="{% url 'home' %}">
        <i class="bi bi-flower1 text-success"></i>
        <strong>Bloomly</strong>
      </a>

      <!-- Mobile Toggle -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain"
              aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Main Navigation -->
      <div class="collapse navbar-collapse" id="navbarMain">
        <!-- Left Side Menu -->
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'lista_roslin' %}">
                <i class="bi bi-flower2"></i> Moje rośliny
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'lista_przypomnie' %}">
                <i class="bi bi-bell"></i> Przypomnienia
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'kalendarz_pielegnacji' %}">
                <i class="bi bi-calendar3"></i> Kalendarz
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'dashboard_analityczny' %}">
                <i class="bi bi-graph-up"></i> Analityka ML
              </a>
            </li>
            <!-- Forum i Baza wiedzy – tylko po zalogowaniu -->
            <li class="nav-item">
              <a class="nav-link" href="{% url 'forum_home' %}">
                <i class="bi bi-chat-dots"></i> Forum
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'baza_roslin_home' %}">
                <i class="bi bi-book"></i> Baza wiedzy
              </a>
            </li>
          {% endif %}
        </ul>

        <!-- Right Side - User Menu -->
        <ul class="navbar-nav align-items-center">
          <!-- Przełącznik motywu -->
          <li class="nav-item">
            <button id="themeToggle" type="button" class="btn btn-outline-secondary btn-sm me-2">
              <i class="bi bi-moon"></i> Motyw
            </button>
          </li>

          {% if user.is_authenticated %}
            <!-- User Dropdown -->
            <li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown"
     role="button" data-bs-toggle="dropdown" aria-expanded="false">
    {% avatar_url user 32 as av %}
    <img src="{{ av }}" alt="" class="rounded-circle me-2" width="32" height="32" style="object-fit:cover;">
    <span>{{ user.first_name|default:user.username }}</span>
  </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                <li>
                  <a class="dropdown-item" href="{% url 'profil' %}">
                    <i class="bi bi-person"></i> Mój profil
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="{% url 'ustawienia_przypomnie' %}">
                    <i class="bi bi-gear"></i> Ustawienia
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                    <i class="bi bi-box-arrow-right"></i> Wyloguj się
                  </a>
                </li>
              </ul>
            </li>
          {% else %}
            <!-- Not Logged In -->
            <li class="nav-item">
              <a class="nav-link" href="{% url 'login' %}">
                <i class="bi bi-box-arrow-in-right"></i> Zaloguj
              </a>
            </li>
            <li class="nav-item">
              <a class="btn btn-success btn-sm ms-2" href="{% url 'rejestracja' %}">
                <i class="bi bi-person-plus"></i> Zarejestruj
              </a>
            </li>
          {% endif %}
        </ul>
      </div> <!-- /.navbar-collapse -->
    </div> <!-- /.container-fluid -->
  </nav>

  <!-- Breadcrumbs (tylko dla zalogowanych) -->
  {% if user.is_authenticated %}
    <nav aria-label="breadcrumb" class="bg-body-tertiary border-top border-bottom">
      <div class="container">
        <ol class="breadcrumb py-3 mb-0">
          <li class="breadcrumb-item">
            <a href="{% url 'home' %}">
              <i class="bi bi-house-door"></i> Dashboard
            </a>
          </li>
          {% block breadcrumbs %}{% endblock %}
        </ol>
      </div>
    </nav>
  {% endif %}

  <!-- Messages -->
  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Main Content -->
  <div class="container main-content">
    {% block content %}{% endblock %}
  </div>

  <!-- Footer (dopasowuje się do motywu) -->
  <footer class="text-center text-muted bg-body-tertiary border-top">
    <div class="container">
      <p class="mb-1">
        <i class="bi bi-flower1 text-success"></i>
        <strong>Bloomly</strong> - Aplikacja do pielęgnacji roślin z inteligentnym systemem ML
      </p>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Przełączanie motywu -->
  <script>
    (function () {
      var btn = document.getElementById('themeToggle');
      if (!btn) return;
      btn.addEventListener('click', function () {
        var current = document.documentElement.getAttribute('data-bs-theme') || 'light';
        var next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-bs-theme', next);
        try { localStorage.setItem('bloomly-theme', next); } catch (e) {}
      });
    })();
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>
