{% extends 'bloomly/base.html' %}
{% load avatar_tags %}

{% block title %}Mój profil - Bloomly{% endblock %}

{% block breadcrumbs %}
<li class="breadcrumb-item active" aria-current="page">Mój profil</li>
{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <div class="mb-3">
          <img src="{% avatar_url request.user 120 %}"
               alt="Avatar"
               class="rounded-circle"
               style="width:120px;height:120px;object-fit:cover;">
        </div>
        <h3 class="h5 mb-1">
          {{ request.user.first_name|default:request.user.username }} {{ request.user.last_name }}
        </h3>
        <div class="text-muted small mb-2">
          <i class="bi bi-envelope"></i> {{ request.user.email }}
        </div>
        <div class="text-muted small mb-3">
          <i class="bi bi-person-badge"></i> @{{ request.user.username }}
        </div>
        <div class="d-grid gap-2">
          <a href="{% url 'zmien_haslo' %}" class="btn btn-outline-secondary">
            <i class="bi bi-key"></i> Zmień hasło
          </a>
          <a href="{% url 'logout' %}" class="btn btn-outline-danger">
            <i class="bi bi-box-arrow-right"></i> Wyloguj
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-8">
    <div class="card shadow-sm">
      <div class="card-header bg-success text-white">
        <h3 class="h5 mb-0"><i class="bi bi-person-gear"></i> Edycja profilu</h3>
      </div>
      <div class="card-body">
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        {% endif %}

        <form method="post" enctype="multipart/form-data" novalidate>
          {% csrf_token %}

          <!-- Dane konta Django User -->
          <h6 class="text-muted mb-3"><i class="bi bi-person-circle"></i> Dane konta</h6>

          <div class="mb-3">
            <label class="form-label">Nazwa użytkownika</label>
            <input type="text" name="username" class="form-control"
                   value="{{ request.user.username }}" required>
            <div class="form-text">Używana do logowania</div>
          </div>

          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control"
                   value="{{ request.user.email }}" required>
            <div class="form-text">Używany do powiadomień</div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Imię</label>
              <input type="text" name="first_name" class="form-control"
                     value="{{ request.user.first_name }}">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Nazwisko</label>
              <input type="text" name="last_name" class="form-control"
                     value="{{ request.user.last_name }}">
            </div>
          </div>

          <hr class="my-4">

          <!-- Dodatkowe dane profilu -->
          <h6 class="text-muted mb-3"><i class="bi bi-info-circle"></i> Dodatkowe informacje</h6>

          <div class="mb-3">
            <label class="form-label">Telefon</label>
            {{ form.telefon }}
            {% if form.telefon.errors %}
              <div class="text-danger small mt-1">
                {% for e in form.telefon.errors %}• {{ e }}<br>{% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label class="form-label">Data urodzenia</label>
            {{ form.data_urodzenia }}
            {% if form.data_urodzenia.errors %}
              <div class="text-danger small mt-1">
                {% for e in form.data_urodzenia.errors %}• {{ e }}<br>{% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label class="form-label">Biogram</label>
            {{ form.biogram }}
            {% if form.biogram.errors %}
              <div class="text-danger small mt-1">
                {% for e in form.biogram.errors %}• {{ e }}<br>{% endfor %}
              </div>
            {% endif %}
          </div>

          {% if form.avatar %}
          <div class="mb-3">
            <label class="form-label">Avatar</label>
            {{ form.avatar }}
            {% if form.avatar.errors %}
              <div class="text-danger small mt-1">
                {% for e in form.avatar.errors %}• {{ e }}<br>{% endfor %}
              </div>
            {% endif %}
          </div>
          {% endif %}

          <hr class="my-4">

          <!-- Preferencje -->
          <h6 class="text-muted mb-3"><i class="bi bi-gear"></i> Preferencje</h6>

          <div class="form-check mb-3">
            {{ form.powiadomienia_email }}
            <label class="form-check-label">
              Otrzymuj powiadomienia email o podlewaniu (3 dni przed terminem)
            </label>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-4">
            <a href="{% url 'home' %}" class="btn btn-outline-secondary">Anuluj</a>
            <button type="submit" class="btn btn-success">
              <i class="bi bi-check-lg"></i> Zapisz zmiany
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}